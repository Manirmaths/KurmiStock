<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="manifest" href="{{ url_for('static', filename='manifest.webmanifest') }}">
  <meta name="theme-color" content="#0f172a"/>
  <link rel="icon" href="{{ url_for('static', filename='icons/icon-192.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <title>KurmiStock AI</title>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <span class="logo">ðŸ“¦</span>
      <a class="brand-name" href="/">KurmiStock <strong>AI</strong></a>
    </div>

    {% if current_user.is_authenticated %}
      <nav class="navlinks">
        <a href="/dashboard">Dashboard</a>
        <a href="/products">Products</a>
        <a href="/sales">Sales</a>
        <a href="/purchases">Purchases</a>
      </nav>
    {% else %}
      <nav class="navlinks">
        <a href="/auth/login">Login</a>
        <a href="/auth/register">Sign up</a>
      </nav>
    {% endif %}

    <div class="righttools">
      <span id="offlineBadge" hidden class="badge warn">Offline</span>
      {% if current_user.is_authenticated %}
        <form method="post" action="{{ url_for('auth.logout_post') }}" onsubmit="return handleLogout(event)">
  <button class="btn ghost" title="Sign out">âŽ‹ Logout</button>
</form>
<script>
async function handleLogout(e){
  e.preventDefault();
  try { await fetch(e.target.action, { method: 'POST', credentials: 'same-origin' }); } catch {}
  if (navigator.serviceWorker?.controller) {
    navigator.serviceWorker.controller.postMessage('CLEAR_CACHES');
  }
  location.replace('{{ url_for("auth.login_form") }}');
  return false;
}
</script>
      {% endif %}
    </div>
  </header>

  <main class="container">
    {% block content %}{% endblock %}
  </main>

  <footer class="foot">
    <small>Â© {{ 2025 }} KurmiStock AI â€¢ Offline-first â€¢ Made for African SMEs</small>
  </footer>
  <div id="toasts" class="toasts"></div>
  <script src="{{ url_for('static', filename='app.js') }}"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('{{ url_for("static", filename="service-worker.js") }}');
    }
  </script>
  
</body>
</html>
